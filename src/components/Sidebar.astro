---
import { personalInfo, socialLinks, navigationLinks } from '../data/portfolio.js';
---

<aside class="sidebar">
    <div class="profile-area">
        <img src={personalInfo.photoPath} alt={`Foto de perfil de ${personalInfo.name}`} class="profile-photo" />
    </div>
    <nav class="side-menu">
        <ul>
            {navigationLinks.map(link => (
                <li><a href={link.href} class="menu-link">{link.name}</a></li>
            ))}
        </ul>
    </nav>

    <div class="theme-toggle-wrapper">
        <button id="theme-toggle" aria-label="Toggle dark mode">
            <i class="fas fa-moon"></i> {/* Este icono se alternará entre fa-moon y fa-sun */}
        </button>
    </div>

    <div class="sidebar-social-links">
        {socialLinks.map(link => (
            <a href={link.url} target="_blank" rel="noopener noreferrer" aria-label={link.name}>
                {link.iconClass && <i class={link.iconClass}></i>}
                {!link.iconClass && link.name}
            </a>
        ))}
    </div>
    <button class="menu-toggle" aria-label="Toggle navigation menu">
        <i class="fas fa-bars"></i>
    </button>
</aside>
<style>
    /* ... (Tus estilos existentes para el sidebar) ... */
    .sidebar {
        width: 280px;
        background-color: var(--bg-light);
        padding: 30px 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        border-right: 1px solid var(--border-color);
        box-shadow: 2px 0 5px var(--shadow-color);
        position: sticky;
        top: 0;
        height: 100vh;
        overflow-y: auto;
        z-index: 100;
        /* Añadir transición para suavizar cambios de ancho o visibilidad en desktop si los hubiera */
        transition: width 0.3s ease, transform 0.3s ease;
    }

    .profile-area {
        text-align: center;
        margin-bottom: 30px;
    }

    .profile-photo {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid var(--primary-color);
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease; /* Efecto de zoom en hover */
    }

    .profile-photo:hover {
        transform: scale(1.05);
    }

    .side-menu {
        width: 100%;
        margin-bottom: 30px;
    }

    .side-menu ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .side-menu li {
        margin-bottom: 15px;
    }

    .side-menu a {
        display: block;
        padding: 12px 15px;
        color: var(--secondary-color);
        font-weight: 500;
        transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
        border-radius: 5px;
        text-align: center;
    }

    .side-menu a:hover:not(.active) { /* Efecto solo si no está activo */
        background-color: var(--primary-color-light); /* Necesitas definir esta variable o usar un rgba */
        color: var(--primary-dark);
        transform: translateX(5px); /* Pequeño desplazamiento */
    }

    /* Estilo para el enlace activo */
    .side-menu a.active {
        background-color: var(--primary-color);
        color: var(--card-bg);
        font-weight: 600; /* Un poco más de peso */
        box-shadow: 0 2px 8px rgba(0,0,0,0.15); /* Sombra sutil para el activo */
    }

    .sidebar-social-links {
        margin-top: auto;
        display: flex;
        flex-direction: column;
        gap: 15px;
        padding-top: 20px;
        border-top: 1px solid var(--border-color);
        width: 100%;
        align-items: center;
    }

    .sidebar-social-links a {
        color: var(--secondary-color);
        font-size: 1.8em;
        transition: transform 0.3s ease, color 0.3s ease;
    }

    .sidebar-social-links a:hover {
        transform: scale(1.1);
        color: var(--primary-color);
    }

    /* Estilos del botón de menú para móvil */
    .menu-toggle {
        display: none; /* Oculto por defecto en desktop */
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000; /* Asegura que esté por encima de todo */
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 50%;
        width: 55px;
        height: 55px;
        font-size: 1.8em;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.3s ease;
    }

    .menu-toggle:hover {
        background-color: var(--primary-dark);
        transform: translateY(-3px);
    }

    /* Media Queries para responsividad */
    @media (max-width: 768px) {
        .sidebar {
            width: 100%;
            height: 100vh;
            position: fixed;
            top: 0;
            left: -100%; /* <-- ESTO LO OCULTA INICIALMENTE */
            border-right: none;
            border-bottom: none;
            box-shadow: none;
            padding: 20px 15px;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            background-color: var(--bg-dark);
            color: var(--card-bg);
            transition: left 0.4s ease-in-out;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            z-index: 200;
        }

        .sidebar.is-open {
            left: 0;
        }

        .profile-area {
            margin-bottom: 20px;
            margin-right: 0; /* Quitar margen derecho en móvil */
        }

        .profile-photo {
            border-color: var(--primary-color); /* Mantener color de borde */
        }

        .side-menu {
            width: 100%;
            margin-bottom: 30px;
        }

        .side-menu ul {
            flex-direction: column; /* Apilar enlaces de menú */
            gap: 0;
        }

        .side-menu li {
            width: 100%; /* Ocupa todo el ancho */
            margin-bottom: 10px;
        }

        .side-menu a {
            font-size: 1.1em;
            color: var(--card-bg); /* Enlaces de menú en blanco */
            padding: 15px 20px; /* Mayor padding */
        }

        .side-menu a:hover,
        .side-menu a.active {
            background-color: var(--primary-dark); /* Color más oscuro para hover/active */
            color: white;
            transform: none; /* Quitar transformación en hover */
        }

        .sidebar-social-links {
            margin-top: 40px; /* Más espacio */
            border-top: 1px solid rgba(255, 255, 255, 0.2); /* Borde claro */
            padding-top: 20px;
            flex-direction: row; /* Iconos en fila */
            justify-content: center;
            gap: 25px;
        }
        .sidebar-social-links a {
            font-size: 1.7em; /* Iconos más grandes en móvil */
            color: var(--card-bg); /* Iconos blancos */
        }
        .sidebar-social-links a:hover {
            color: var(--primary-color);
        }

        .menu-toggle {
            display: flex; /* Mostrar botón de menú */
            justify-content: center;
            align-items: center;
        }
        .menu-toggle.is-active i.fa-bars {
            display: none; /* Oculta el icono de barras */
        }
        .menu-toggle.is-active::before {
            content: "\f00d"; /* Muestra la 'X' */
            font-family: 'Font Awesome 5 Free'; /* Asegúrate de que apunte a tu font awesome */
            font-weight: 900; /* Font Awesome Solid */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    }

    .theme-toggle-wrapper {
        width: 100%;
        text-align: center;
        margin-top: 20px; /* Espacio con el menú */
        margin-bottom: 20px; /* Espacio con los enlaces sociales */
        padding-top: 15px;
        border-top: 1px solid var(--border-color);
    }

    #theme-toggle {
        background: var(--primary-color-light); /* Usar variable para el fondo */
        color: var(--secondary-color); /* Color del icono */
        border: 1px solid var(--border-color);
        border-radius: 50%;
        width: 45px;
        height: 45px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        font-size: 1.2em;
        transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
        box-shadow: 0 2px 5px var(--shadow-color);
        margin: 0 auto; /* Centrar el botón */
    }

    #theme-toggle:hover {
        background-color: var(--primary-color);
        color: white;
        transform: translateY(-2px);
    }

    body.dark-mode #theme-toggle {
        background-color: var(--primary-color); /* Fondo del botón en dark mode */
        color: white; /* <--- ¡Este es el que hace que el icono sea blanco! */
        border-color: var(--primary-color);
    }

    body.dark-mode #theme-toggle .fa-sun {
        display: inline-block; /* Muestra el sol en dark mode */
    }
    #theme-toggle .fa-sun {
        display: none; /* Oculta el sol en light mode */
    }

    /* ... (Media Queries para responsividad del sidebar) ... */

    /* Ajustes específicos para el botón en móvil si es necesario1 */
    @media (max-width: 768px) {
        .theme-toggle-wrapper {
            border-top: 1px solid var(--border-color);
        }
        #theme-toggle {
            background: var(--card-bg); /* Fondo del botón en claro para sidebar móvil */
            color: var(--secondary-color); /* Color del icono en claro para sidebar móvil */
        }
        body.dark-mode #theme-toggle {
            background: var(--primary-color); /* Fondo del botón en oscuro para sidebar móvil */
            color: white; /* Color del icono blanco para sidebar móvil en dark mode */
        }
    }
</style>

<script is:inline>
    // Tu script JavaScript (sin cambios aquí, ya que la lógica del icono está bien)
    document.addEventListener('DOMContentLoaded', () => {
        const sidebar = document.querySelector('.sidebar');
        const menuToggle = document.querySelector('.menu-toggle');
        const mainContent = document.querySelector('main');
        const menuLinks = document.querySelectorAll('.side-menu .menu-link');
        const sections = document.querySelectorAll('main section[id]');
        const themeToggle = document.getElementById('theme-toggle');

        const toggleDarkMode = () => {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');

            const icon = themeToggle.querySelector('i');
            if (icon) {
                if (isDarkMode) {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                }
            }
        };

        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
        }

        const initialIcon = themeToggle.querySelector('i');
        if (initialIcon) {
            if (document.body.classList.contains('dark-mode')) {
                initialIcon.classList.remove('fa-moon');
                initialIcon.classList.add('fa-sun');
            } else {
                initialIcon.classList.remove('fa-sun');
                initialIcon.classList.add('fa-moon');
            }
        }

        if (themeToggle) {
            themeToggle.addEventListener('click', toggleDarkMode);
        }

        if (menuToggle) {
            menuToggle.addEventListener('click', () => {
                if (sidebar) sidebar.classList.toggle('is-open');
                if (menuToggle) menuToggle.classList.toggle('is-active');
                if (mainContent) mainContent.classList.toggle('sidebar-open');
            });
        }

        menuLinks.forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    if (sidebar) sidebar.classList.remove('is-open');
                    if (menuToggle) menuToggle.classList.remove('is-active');
                    if (mainContent) mainContent.classList.remove('sidebar-open');
                }
            });
        });

        const activateNavLink = () => {
            let currentActiveLink = null;
            let scrollY = window.scrollY || window.pageYOffset;

            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                const sectionHeight = section.offsetHeight;
                const sectionId = section.getAttribute('id');

                if (scrollY >= sectionTop && scrollY < sectionTop + sectionHeight) {
                    currentActiveLink = document.querySelector(`.side-menu a[href="#${sectionId}"]`);
                }
            });

            menuLinks.forEach(link => {
                link.classList.remove('active');
            });
            if (currentActiveLink) {
                currentActiveLink.classList.add('active');
            } else {
                const homeLink = document.querySelector('.side-menu a[href="#hero"]');
                if (homeLink) {
                    homeLink.classList.add('active');
                }
            }
        };

        window.addEventListener('scroll', activateNavLink);
        activateNavLink();
    });
</script>
